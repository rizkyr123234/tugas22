<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/javascript/jquery,min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
  <div class="card">
    <div class="card-header">
        <h2>Cari Mahasiswa</h2>
    </div>
    <div class="card-body">
        <form id="form-Search">
            <div class="row mb-3">
              <label for="carinama" class="col-sm-2 col-form-label">Nama</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="carinama" name="carinama" >
              </div>
            </div>
            <div class="row mb-3">
              <label for="cariberat" class="col-sm-2 col-form-label">Berat</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="cariberat" name="cariberat">
              </div>
            </div>
            <div class="row mb-3">
                <label for="caritinggi" class="col-sm-2 col-form-label">Tinggi</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="caritinggi" name="caritinggi">
                </div>
              </div>
              <div class="row mb-3">
                <label for="lahir" class="col-sm-2 col-form-label">Tanggal Lahir</label>
                <div class="col-sm-10">
                  <input type="date" class="form-control" id="caridate" name="caridate">
                </div>
              </div>
            <fieldset class="row mb-3">
              <legend class="col-form-label col-sm-2 pt-0">Status</legend>
              <div class="col-sm-10">
                <div class="form-check">
                  <input class="form-check-input" type="radio"  id="sudahmenikah3" value="pilih" name="caristatus" checked>
                  <label class="form-check-label" for="sudahmenikah3">
                    pilih
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio"  id="sudahmenikah1" value="nikah" name="caristatus" >
                  <label class="form-check-label" for="sudahmenikah1">
                    nikah
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio"  id="sudahmenikah2" value="jomblo" name="caristatus" >
                  <label class="form-check-label" for="sudahmenikah2">
                    jomblo
                  </label>
                </div>
                
              </div>
            </fieldset>
            
            <button type="submit" class="btn btn-primary">Cari</button>
            <button type="button" id="reset-form-search" class="btn btn-warning">RESET</button>
          </form>
    </div>
</div>
    <h1>Data Mahasiswa</h1>

    <div class="container">
    <table class="table table-stripped">
        <thead>
            <tr>
                <th>NO</th>
                <th>Nama</th>
                <th>BERAT</th>
                <th>Tinggi</th>
                <th>Status</th>
                <th>Tanggal Lahir</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
           
        </tbody>
    </table>
<div class="row">
  <nav aria-label="...">
    <ul class="pagination" id="pagination">
      
    </ul>
  </nav>
  
  <div class="col-2" >
    display :
    <select name="display" id="display" class="form-control">
      <option value="3">3</option>
      <option value="5">5</option>
      <option value="10">10</option>
    </select>
  </div>
</div>
   
    <div class="card">
        <div class="card-header">
            <h2>Form Mahasiswa</h2>
        </div>
        <div class="card-body">
            <form id="form-mahasiswa">
              <input type="hidden" name="id" id="id" value="">
                <div class="row mb-3">
                  <label for="nama" class="col-sm-2 col-form-label">Nama</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="nama" name="nama" required>
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="berat" class="col-sm-2 col-form-label">Berat</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="berat" name="berat">
                  </div>
                </div>
                <div class="row mb-3">
                    <label for="tinggi" class="col-sm-2 col-form-label">Tinggi</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="tinggi" name="tinggi">
                    </div>
                  </div>
                  <div class="row mb-3">
                    <label for="lahir" class="col-sm-2 col-form-label">Tanggal Lahir</label>
                    <div class="col-sm-10">
                      <input type="date" class="form-control" id="date" name="date">
                    </div>
                  </div>
                <fieldset class="row mb-3">
                  <legend class="col-form-label col-sm-2 pt-0">Status</legend>
                  <div class="col-sm-10">
                    <div class="form-check">
                      <input class="form-check-input" type="radio"  id="sudahmenikah1" value="menikah" name="status" >
                      <label class="form-check-label" for="sudahmenikah1">
                        nikah
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio"  id="sudahmenikah2" value="jomblo" name="status" checked>
                      <label class="form-check-label" for="sudahmenikah2">
                        jomblo
                      </label>
                    </div>
                    
                  </div>
                </fieldset>
                
                <button type="submit" class="btn btn-primary">Simpan</button>
              </form>
        </div>
    </div>
    
  </div>
</div>
</body>
<script>
  var params = {
    page: 1,
    limit: 3
  }
    
//============================BACA DATA ========================
    const readData = () =>{ // arrow function 

        $.ajax({
  method: "GET",
  url: "http://localhost:3000/users",
  dataType : "json",
  data: params
}).done(function( response) {
  params={...params,pages:response.pages}
    let html = ''
   let pagi = `
  <ul class="pagination">
          <li class="page-item"><a class="page-link" href="#">Previous</a></li>`
          for(let i = 1; i<=response.pages;i++){
      pagi+=`<li class="page-item"><a class="page-link" id ="cek" href=${i}>${i}</a></li>`
    }    
          
  pagi+=       ` <li class="page-item"><a class="page-link" href="#">Next</a></li>
        </ul>
  `
   response.data.forEach((item,index)=>{
   html+=`
   <tr>
                <td>${index+1}</td>
                <td>${item.nama}</td>
                <td>${item.berat}</td>
                <td>${item.tinggi}</td>
                <td>${item.status==true?'menikah':'jomblo'}</td>
                <td>${item.lahir}</td>
                <td>
            <button type="button" class="btn btn-success btn-sm btn-edit" iddata="${item._id}">edit</button>  
            <button type="button" class="btn btn-danger btn-sm btn-delete" deletedata="${item._id}">hapus</button>
           </td>
  </tr>
   `
   // jqewry punya kemampuan detect event
})

$('table tbody').html(html)
pagination()
// document.getElementById('pagination').innerHTML= pagi
  }).fail(function(err){
    alert('gagal pake jquery ')
  })
   
}

//============================ADD DAN EDIT========================
const tambah=(id,nama,berat,tinggi,status,date)=>{
  
  if(id){
    $.ajax({
  method: "PUT",
  url: `http://localhost:3000/users/${id}`,
  dataType : "json",
  data: {id,nama,berat,tinggi,status,date}
}).done(function( response) {
readData()
$("#id").val('')
$("#form-mahasiswa").trigger('reset')
  })
  }else{
    $.ajax({
  method: "POST",
  url: `http://localhost:3000/users`,
  dataType : "json",
  data: {nama,berat,tinggi,status,date}
}).done(function( response) {
readData()
$("#form-mahasiswa").trigger('reset')
  })
}
}

//============================DELETE========================
const del=(id)=>{
  $.ajax({
  method: "DELETE",
  url: `http://localhost:3000/users/${id}`,
  dataType : "json",
}).done(function( response) {
readData()

  })
}
//============================EDIT========================
const edit=(id)=>{
 
  $.ajax({
  method: "GET",
  url: `http://localhost:3000/users/${id}`,
  dataType : "json",
}).done(function( response) {
   
   $('#id').val(response._id)
     $('#nama').val(response.nama) 
     $('#berat').val(response.berat) 
     $('#tinggi').val(response.tinggi) 
     $(`input[value="${response.status==true?'menikah':'jomblo'}"]`).prop('checked',true)
     $('#date').val(response.lahir) 
  })
}
const pagination = () =>{
  params={...params, display: $('#display').val()}
    let pagination = `
    <li class="page-item">
        <a class="page-link" href="#" tabindex="-1" aria-disabled="true" datapage="${params.page - 1}">Previous</a>
      </li>`
      for(let i =1; i<=params.pages;i++){
        pagination+=`<li class="page-item ${i==params.page?'active':''}"><a class="page-link" href="#" datapage="${i}">${i}</a></li>`
     

      }
     pagination+= `<li class="page-item">
        <a class="page-link" href="#" datapage="${params.page + 1}" tabindex="+1">Next</a>
      </li>
    `
    
    $('#pagination').html(pagination)
}
//============================LOAD DATA UNTUK MENGIRIM KE ATAS========================
$(document).ready(function(){
  // kalo search by id ganti jadi pake crash tp kalo class ganti jadi pake .(namaclass)
    readData()
$("#form-mahasiswa").submit(function(event){ // pake lansgung submit soalnya udah ada dari sana submitnya 
    event.preventDefault(); //mencegah supaya tidak pindah halaman, karena form itu behaviour nya pindah halaman 
    const id        = $('#id').val()
    const nama      = $('#nama').val()
    const berat     = $('#berat').val()
    const tinggi    = $('#tinggi').val()
    const status    = $('input[name="status"]:checked').val()
    const date      = $('#date').val()

    tambah(id,nama,berat,tinggi,status,date)
})

$('table tbody').on('click','.btn-edit', function(){
  const id = $(this).attr('iddata')
  edit(id)
}) // pake .on('click') karna clicknya tidak ada dari sana nya tidak langsung jadi 
$('table tbody').on('click','.btn-delete', function(){
  const id = $(this).attr('deletedata')
  del(id)
})
$('#reset-form-search').click(function(){
  readData()
  params ={
    page: 1,
    limit: 3
  }
  $("#form-Search").trigger('reset')
})

$("#form-Search").trigger('reset')
$("#form-Search").submit(function(event){
    event.preventDefault(); //mencegah supaya tidak pindah halaman, karena form itu behaviour nya pindah halaman 
    
    const nama      = $('#carinama').val()
    const berat     = $('#cariberat').val()
    const tinggi    = $('#caritinggi').val()
    const status    = $('input[name="caristatus"]:checked').val()
    const date      = $('#caridate').val()
    params = {...params,nama,berat,tinggi,status,date}
    readData()
})
$('#display').change(function(){
  params={...params, display: $('#display').val()}
  readData()
})
$('#pagination').on('click','.page-link', function(event){
  event.preventDefault();
  params = {...params, page:$(this).attr('datapage')}
  readData()
})
})


</script>
</html>